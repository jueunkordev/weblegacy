create SEQUENCE mno start WITH 1 INCREMENT BY 1 MAXVALUE 500 NOCYCLE NOCACHE;

CREATE TABLE PDS(
MIDX NUMBER(5) NOT NULL,
PD1 NVARCHAR2(50) NULL,
PD2 NVARCHAR2(50) NULL,
PD3 NVARCHAR2(50) NULL,
PD4 NVARCHAR2(50) NULL,
PD5 NVARCHAR2(50) NULL,
PRIMARY KEY(MIDX)
);

SELECT * FROM PDS ORDER BY midx desc;

/* 회원가입 테이블
 * 고유값
 * 아이디
 * 이름
 * 닉네임(카카오)
 * 패스워드(암호화-MD5)
 * 이메일
 * 연락처(휴대폰) - 숫자만
 * 가입형태 - web,kakao,naver,google,facebook
 * */ 

create table membership(
   MIDX NUMBER(3) NOT NULL,
   MCODE INTEGER DEFAULT '1' NOT NULL,
   MID NVARCHAR2(30) NOT NULL,
   MNAME NCHAR(10) NOT NULL,
   MNICK NVARCHAR2(100) NULL,
   MPASS NVARCHAR2(100) NOT NULL,
   MEMAIL NVARCHAR2(50) NOT NULL,
   MHP NCHAR(11) NOT NULL,
   MJOIN NCHAR(10) NOT NULL,
   CONSTRAINT JOINPART CHECK(MJOIN IN('WEB','KAKAO','NAVER')),
   MDATE TIMESTAMP DEFAULT SYSDATE,
   PRIMARY KEY(MIDX),
   UNIQUE (MID),
   UNIQUE (MHP),
   UNIQUE (MEMAIL)
);

INSERT INTO MEMBERSHIP VALUES(MNO.NEXTVAL, '1', 'id1', '이름1', '닉네임1', '111', '이메일1', '01011111111','WEB','');

DELETE FROM MEMBERSHIP;

drop table membership;

select * from membership;

ALTER TABLE MEMBERSHIP MODIFY MPASS NVARCHAR2(100);

CREATE TABLE COUPON(
MIDX NUMBER(3) NOT NULL,
COUPON_NM NVARCHAR2(50) NOT NULL,
COUPON_POINT NUMBER(6) NOT NULL,
COUPON_DATE TIMESTAMP DEFAULT SYSDATE
);

DROP TRIGGER CP;

SELECT TRIGGER_NAME FROM USER_TRIGGERS WHERE TABLE_NAME = 'MEMBERSHIP';

CREATE OR REPLACE TRIGGER CP
AFTER INSERT ON MEMBERSHIP
FOR EACH ROW
BEGIN
  INSERT INTO COUPON (MIDX, COUPON_NM, COUPON_POINT, COUPON_DATE)
  VALUES (:NEW.MIDX, '신규 회원가입 쿠폰', 10000, SYSDATE);
END

// TRIGGER 정지
ALTER TRIGGER CP DISABLE;

// TRIGGER 재실행
ALTER TRIGGER CP ENSABLE;

SELECT * FROM COUPON;

// JOIN => ON AND WHERE
// JOIN => ON
// , => WHERE
// Oracle Table JOIN 시 주의점 ON 사용 후 WHERE 적용해야 합니다
SELECT A.MIDX, A.MCODE, A.MID, A.MNAME, A.MEMAIL, B.COUPON_NM
FROM MEMBERSHIP A
JOIN COUPON B ON A.MIDX = B.MIDX;

//Table JOIN 시 WHERE을 바로 사용해야 할 경우 Table과 Table 사이에 , 로 핸들링
CREATE VIEW USER_INFO AS SELECT A.MIDX, A.MCODE, A.MID, A.MNAME, A.MEMAIL, B.COUPON_NM
FROM MEMBERSHIP A ,COUPON B WHERE A.MIDX = B.MIDX;

SELECT * FROM USER_INFO;

DROP VIEW USER_INFO;











